
## METALpy 0.2.0 Release Notes

å‘å¸ƒ METALpy 0.2.0.

ä¸»è¦æ›´æ–°å†…å®¹ä¸ºå®Œå–„Demagedæ’ä»¶ã€Sceneæ”¯æŒæ„å»ºå…«å‰æ ‘ã€ModelledMeshæ”¯æŒæ‰©å¼ è¾¹ç•Œã€
å®ç°PDEæ­£æ¼”Simulation3DDifferentialå’Œç£å¶æå­æ­£æ¼”Simulation3DDipolesç­‰ã€‚

**Demaged**

å¼•å…¥é‡‡ç”¨BCEç®—æ³•çš„ `BCESolver` ï¼Œæ”¯æŒä»»æ„å¤§å°çš„è§„åˆ™ç½‘æ ¼ï¼Œå¹¶å°†æ ¸çŸ©é˜µä¹˜æ³•çš„æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–ä¸ºçº¿æ€§å¤æ‚åº¦O(n)ï¼Œæœ‰æ•ˆæé«˜é€€ç£çš„æ•ˆåº”æ±‚è§£æ•ˆç‡ã€‚

`BCESolver` åœ¨è§„åˆ™ç½‘æ ¼ä¸Šçš„æ±‚è§£æ•ˆç‡æ˜¾è‘—ä¼˜äºä¼ ç»Ÿæ–¹æ³•ï¼Œç°å·²ä½œä¸ºè§„åˆ™ç½‘æ ¼ä¸Šé€€ç£æ•ˆåº”çš„é»˜è®¤æ±‚è§£å™¨ã€‚

```python
builder = SimulationBuilder.of(magnetics.Simulation3DIntegral)
builder.patched(
    Tied(arch='gpu'), 
    Progressed(), 
    Demaged(progress=True)  # è§„åˆ™ç½‘æ ¼ä¸Šç°åœ¨é»˜è®¤é‡‡ç”¨BCEæ±‚è§£å™¨
)
```

**Simulation3DDifferential**

å®ç°äº†é€‚ç”¨äº `Simulation3DDifferential` çš„builderï¼Œæ”¯æŒæ„å»ºå·®åˆ†æ–¹ç¨‹æ­£æ¼”ã€‚

åŒæ—¶åŸºäº `PyAMG` (CPU) / `PyAMGX` (CUDA) å®ç°ä»£æ•°å¤šé‡ç½‘æ ¼æ³•æ±‚è§£å™¨ `AMGSolver` ï¼ŒåŠ é€Ÿå¾®åˆ†æ–¹ç¨‹æ±‚è§£æ•ˆç‡ã€‚

```python
builder = SimulationBuilder.of(magnetics.Simulation3DDifferential)
builder.patched(Formatted(), Fixed())  # ä¿®å¤å¹¶æ ¼å¼åŒ–dpredå‡½æ•°çš„è¾“å‡ºç»“æœ
builder.solver(AMGSolver, progress=True)
builder.receivers(rxLoc, components)
builder.chi_map()  # å°†ç£åŒ–ç‡æ˜ å°„ä¸ºç£å¯¼ç‡
builder.active_mesh(model_mesh)  # è‡ªåŠ¨å°†æœ‰æ•ˆç½‘æ ¼ä¸Šçš„æ¨¡å‹åµŒå…¥åˆ°å®Œæ•´ç½‘æ ¼ç©ºé—´ä¸­

builder.build().dpred(susc_model)
```

**Simulation3DDipoles**

å®ç°ç£å¶æå­æ­£æ¼” `Simulation3DDipoles` ä»¥åŠå¯¹åº”çš„builderï¼Œæ”¯æŒç£å¶æå­çš„æ­£æ¼”è®¡ç®—ã€‚

```python
builder = SimulationBuilder.of(Simulation3DDipoles)
builder.sources(dipole_location)  # è®¾ç½®ç£å¶æå­ä½ç½®
builder.receivers(rx_loc, components)
builder.build().dpred(moment_model)  # è¾“å…¥ç£çŸ©æ¨¡å‹ï¼Œè®¡ç®—ç£å¶æå­æ­£æ¼”å“åº”
```

**Formatted**

æ–°å¢ `Formatted` æ’ä»¶ï¼Œæ”¯æŒå°†æ­£æ¼”ç»“æœæ ¼å¼åŒ–ä¸ºæ›´ç›´è§‚çš„çŸ©é˜µæˆ–è¡¨æ ¼å½¢å¼ã€‚

```python
builder = SimulationBuilder.of(magnetics.Simulation3DIntegral)
# ...
builder.patched(Formatted(pandas=True, locations=True))  # å°†é¢„æµ‹ç»“æœæ ¼å¼åŒ–ä¸ºpd.DataFrameï¼Œå¹¶å’Œæµ‹ç‚¹åæ ‡å…³è”
# ...
```

```shell
<<< builder.build().dpred(susc_model)
>>>         x         y     z  ...        byy        byz        bzz
>>> 0    -3.0 -3.000000  20.0  ... -26.565485 -18.380489  53.915525
>>> 1    -3.0 -2.866667  20.0  ... -27.014855 -17.717098  54.499417
>>> 2    -3.0 -2.733333  20.0  ... -27.449319 -17.036763  55.063062
>>> ...   ...       ...   ...  ...        ...        ...        ...
>>> 2115  3.0  3.000000  20.0  ... -27.137554  17.432963  54.230056
>>> [2116 rows x 13 columns]
```

**Scene.build_tree**

æ–°å¢ `Scene.build_tree` æ–¹æ³•ï¼Œæ”¯æŒè‡ªé¡¶å‘ä¸‹æˆ–è‡ªåº•å‘ä¸Šåœ°æ„å»ºå…«å‰æ ‘ç½‘æ ¼ã€‚

```python
bunny = pyvista.examples.downloads.download_bunny()
bunny.flip_normals()
scene = Scene.of(Obj2(bunny, surface_range=[None, 0]))

octree_mesh = scene.build_tree(n_cells=[64, 62, 48])  # ä¼šè‡ªåŠ¨æ‰©å±•ä¸º2çš„å¹‚æ¬¡æ–¹ä¸ªç½‘æ ¼
```

**ModelledMesh**

æ–°å¢ `ModelledMesh.expand` æ–¹æ³•ï¼Œæ”¯æŒå¯¹ç½‘æ ¼è¿›è¡Œæ‰©å¼ æˆ–æ”¶ç¼©æ“ä½œã€‚

```python
new_bounds = model_mesh.bounds.expand(proportion=0.5)  # è®¾ç½®æ–°ç½‘æ ¼åŒºåŸŸè¾¹ç•Œä¸ºåŸè¾¹ç•Œåœ¨å„ä¸ªæ–¹å‘æ‰©å¼ 50%
model_mesh = model_mesh.expand(new_bounds, ratio=1.2)  # é‡‡ç”¨æŒ‡æ•°æ‰©å¤§ç½‘æ ¼ï¼Œå°†ç½‘æ ¼æ‰©å¼ åˆ°è¦†ç›–æ–°è¾¹ç•ŒåŒºåŸŸ
```

### Added

- ğŸ‘·â€â™‚ï¸ å®ç°Github Actionsä¸‹çš„è‡ªåŠ¨æ‰“åŒ…ä¸æµ‹è¯• [[969003f](https://github.com/MetallyInduced/metalpy/commit/969003f87619728f0aa96794894ecfa5876fe2ad)]
- âœ¨ å®ç°åŸºäºBCEåŠ é€Ÿçš„é€€ç£æ±‚è§£å™¨BCESolverï¼Œæé«˜è§„åˆ™ç½‘æ ¼é€€ç£æ•ˆåº”æ±‚è§£æ•ˆç‡ [[d952e30](https://github.com/MetallyInduced/metalpy/commit/d952e30675cc80d28dfcd57b751d4c0c3519a27e)]
- âœ¨ ModelledMeshå®ç°MeshZæ ¼å¼ç”¨äºæŒä¹…åŒ–å­˜å‚¨ [[d904dd4](https://github.com/MetallyInduced/metalpy/commit/d904dd4a4d8c10abeff0f9135a0c64502b62588e)]
- âœ¨ CompressedSolverå®ç°cutoffå‚æ•°ï¼Œå°†è¶…å‡ºæˆªæ–­è·ç¦»çš„å…ƒç´ è®¾ç½®ä¸º0 [[62e2dda](https://github.com/MetallyInduced/metalpy/commit/62e2ddaa07ffdeef459724af5021a49d7d69024b)]
- âœ¨ Demagedæ’ä»¶æ–°å¢cutoffå‚æ•°ï¼Œç”¨äºæŒ‡å®šé€€ç£æ•ˆåº”æ±‚è§£çš„æˆªæ–­è·ç¦» [[0c45fa3](https://github.com/MetallyInduced/metalpy/commit/0c45fa35826e768644dc7d5b37b5383fcad9cb1f)]
- âœ¨ file_cachedæ–°å¢serializerå‚æ•°ï¼Œæ”¯æŒæŒ‡å®šç¼“å­˜æ–‡ä»¶æ ¼å¼ [[3bdc9a8](https://github.com/MetallyInduced/metalpy/commit/3bdc9a8babda9133c47b2942206e0a2b6c83b7d4)]
- âœ¨ AerialSurvey.to_polydataå®ç°æ”¯æŒæŒ‡å®šè¾“å‡ºPolyDataçš„ç‚¹æ•°æ®ï¼ˆä»¥å®ç°è‡ªå®šä¹‰ç€è‰²ï¼‰ [[3172e42](https://github.com/MetallyInduced/metalpy/commit/3172e429e015b9aa444f84ade7e59c144b66d34c)]
- âœ¨ å®ç°åŸºäºå…³ç³»ç´¢å¼•çš„é€€ç£æ±‚è§£å™¨IndexedSolverï¼Œå®ç°ä»»æ„å¤§å°ç½‘æ ¼çš„é€€ç£è®¡ç®— [[e3bf199](https://github.com/MetallyInduced/metalpy/commit/e3bf19995e50d94d22b4cbea8a935ce04200d20a)]
- âœ¨ å®ç°Scene.build_treeæ”¯æŒå¤šmodelåœºæ™¯ [[d46d687](https://github.com/MetallyInduced/metalpy/commit/d46d687c22524b0a4453e6449aabaff70e13cb12)]
- âœ¨ ModelledMeshå®Œå–„å¯¹ç¨€ç–ç´¢å¼•çš„æ”¯æŒ [[94f55a4](https://github.com/MetallyInduced/metalpy/commit/94f55a474a932eb0101263d002ffca0b09deb5e3)]
- âœ¨ å®ç°Scene.build_treeæ”¯æŒè‡ªé¡¶å‘ä¸‹æˆ–è‡ªåº•å‘ä¸Šåœ°æ„å»ºå…«å‰æ ‘ç½‘æ ¼ [[c87d2e7](https://github.com/MetallyInduced/metalpy/commit/c87d2e7bdc313b661295531c89b7e906a735a3e1)]
- âœ¨ Scene.build_activeæ·»åŠ æŒ‡å®šæˆªæ–­æœ‰æ•ˆä½æ•°çš„å®¹å·®å‚æ•° [[2a108e6](https://github.com/MetallyInduced/metalpy/commit/2a108e6cd03fbfd2f3ca1cda07256468c44a497f)]
- âœ¨ Prismå®ç°é‡ç›¸äº¤ç®—æ³•æ‹†è§£å¤æ‚å¤šè¾¹å½¢ [[8a9d031](https://github.com/MetallyInduced/metalpy/commit/8a9d031d704fa1e6e4ef6b3df10671c4f263a960)]
- âœ¨ å®ç°SimPEGä»£æ•°å¤šé‡ç½‘æ ¼æ±‚è§£å™¨ [[e501bad](https://github.com/MetallyInduced/metalpy/commit/e501bad0ee350956e4a35af09b962e9970cc86e0)]
- âœ¨ Tiedå®ç°åˆæ­¥æ”¯æŒSimulation3DDifferential [[4530f61](https://github.com/MetallyInduced/metalpy/commit/4530f61bce51db1768593157c4b4332d08f6df9b)]
- âœ¨ å®ç°DispatcherMixinä»¥æŠ½è±¡Mixinæ ¹æ®å®¿ä¸»ç±»åŒ¹é…å…·ä½“å®ç°çš„èŒƒå¼ [[bbb9108](https://github.com/MetallyInduced/metalpy/commit/bbb9108f6782064cd79abacc9008a49028340200)]
- âœ¨ Progressedå®ç°æ”¯æŒå•è¿›ç¨‹æ¨¡å¼ä¸‹çš„BasePFSimulation [[9b49e78](https://github.com/MetallyInduced/metalpy/commit/9b49e7844064cf67214bfb3346535c2c1d4f8520)]
- âœ¨ æ‰©å±•taichi_lazyä¸ºti_lazyæ¨¡å—ï¼Œå®ç°ç¼“å¼åŠ è½½taichiå’Œæ„å»ºti.kernel [[19dcdf4](https://github.com/MetallyInduced/metalpy/commit/19dcdf45db80a173d645aebed6ec1e30651b79c1)]
- âœ… æ·»åŠ SimulationBuilderç›¸å…³æµ‹è¯• [[5e915b7](https://github.com/MetallyInduced/metalpy/commit/5e915b7e820f1009b404555a533d40174b83fa29)]
- âœ¨ Obj2æ·»åŠ reset_originå’Œkeep_origin_transformå‚æ•°æ¥æ§åˆ¶å±€éƒ¨åæ ‡ç³»çš„è¡Œä¸º [[71b4a5a](https://github.com/MetallyInduced/metalpy/commit/71b4a5a817ccf62e5a6e7cac80e76ec297f4b072)]
- âœ¨ Taichiç£æ­£æ¼”å’Œé€€ç£æ±‚è§£å™¨æ”¯æŒæŒ‡å®šæ ¸çŸ©é˜µæ•°æ®ç±»å‹ï¼ˆTiedå’ŒDemagedæ’ä»¶ï¼‰ [[be24917](https://github.com/MetallyInduced/metalpy/commit/be24917100075894e4cb685f941524a897ba40b3)]
- âœ¨ å®ç°Simulation3DDipolesä»¥æ”¯æŒç£å¶æå­æ­£åæ¼” [[6c05622](https://github.com/MetallyInduced/metalpy/commit/6c05622e821d77e1840adf46d305a8f4149ae9cd)]
- âœ¨ ModelledMeshæ·»åŠ expandæ–¹æ³•ç”¨äºé€šè¿‡å˜é•¿ç½‘æ ¼æ‰©å¼ æˆ–æ”¶ç¼©ç½‘æ ¼è¾¹ç•Œ [[79dd744](https://github.com/MetallyInduced/metalpy/commit/79dd744447addbf6916dc95bd090c09b28ba3f73)]
- âœ¨ å®ç°Formattedæ’ä»¶æ”¯æŒå°†æ­£æ¼”ç»“æœæ ¼å¼åŒ–ä¸ºæ›´ç›´è§‚çš„çŸ©é˜µå½¢å¼ [[2d797aa](https://github.com/MetallyInduced/metalpy/commit/2d797aacf0d88020f2071df2cf91362c8aed616a)]
- âœ¨ å®ç°Simulation3DDifferentialBuilderç”¨äºæ„å»ºå·®åˆ†æ–¹ç¨‹æ­£æ¼” [[1de323c](https://github.com/MetallyInduced/metalpy/commit/1de323cc9e13f0f2e34efe842af6858b7ed63746)]
- âœ¨ Cuboidå®ç°é«˜æ€§èƒ½do_compute_implicit_distanceæ–¹æ³• [[887376a](https://github.com/MetallyInduced/metalpy/commit/887376a50eb68301607c6c3eaa82d35c24cdfdff)]
- âœ¨ Scene.ofæ”¹ä¸ºclassmethodå®ç°ï¼Œä»¥æ”¯æŒSceneç»§æ‰¿ [[e9c8993](https://github.com/MetallyInduced/metalpy/commit/e9c8993a2a2a2da76f03a96b618921aa4cc14657)]

### Changed

- â™»ï¸ å°†intç±»å‹æ˜¾å¼æŒ‡å®šä¸ºnp.intpï¼ˆsize_tï¼‰ [[ff5aa7d](https://github.com/MetallyInduced/metalpy/commit/ff5aa7d81eea70ab5587984df2dd7687d998e863)]
- â™»ï¸ åˆ†ç¦»BCESolverçš„torchå’ŒnumpyåŸè¯­ [[f9d13ac](https://github.com/MetallyInduced/metalpy/commit/f9d13ac53a13a19b696cc47e2bb1f964dd2661e5)]
- ğŸš¸ ä¼˜åŒ–dispatch_solverä¸­é€€ç£æ±‚è§£å™¨é»˜è®¤é€‰æ‹©åˆ†é…é€»è¾‘ [[9f94888](https://github.com/MetallyInduced/metalpy/commit/9f948885c7b61d1709c8bf49a586ca1802bcb078)]
- âš¡ DemagSolverContextæ”¹ä¸ºé‡‡ç”¨CachedPropertyå®ç°ï¼Œå‡å°‘ä¸å¿…è¦çš„å†…å­˜æ¶ˆè€— [[5fadb63](https://github.com/MetallyInduced/metalpy/commit/5fadb6353358188e400ae2ebda778be8d9a0f597)]
- âš¡ IndexedSolverå®ç°ç»†ç²’åº¦å¹¶è¡Œï¼Œä¼˜åŒ–è®¡ç®—æ•ˆç‡ [[6da13fb](https://github.com/MetallyInduced/metalpy/commit/6da13fb9eef868f7d00dcfb1ba619fda01dd7358)]
- âš¡ ä¼˜åŒ–IndexedSolverä»¥æ”¯æŒä»…æ±‚è§£æœ‰æ•ˆç½‘æ ¼é€€ç£æ•ˆåº” [[3520da0](https://github.com/MetallyInduced/metalpy/commit/3520da0d59b48e44a3d32f8f6912f2c56d193a5e)]
- âš¡ å®ç°è·³è¿‡TreeMesh.refineæ„é€ å…«å‰æ ‘ï¼Œæé«˜æ„é€ æ•ˆç‡ [[d14d5e2](https://github.com/MetallyInduced/metalpy/commit/d14d5e2d884441444351857a5965992a2619cb06)]
- â™»ï¸ ä¼˜åŒ–PTOPOæ ¼å¼ï¼Œå…è®¸çœç•¥ä¸Šä¸‹åº•é¢é«˜åº¦ï¼Œå¹¶ç²¾ç®€åµŒå¥—ç»“æ„ [[b9c3589](https://github.com/MetallyInduced/metalpy/commit/b9c3589d3eb77de30159b26b7eb7afb002d35ccd)]
- â™»ï¸ é‡å†™Distributedæ’ä»¶ï¼Œæ”¹ä¸ºåŸºäºDispatcherMixinå®ç° [[0bfac3d](https://github.com/MetallyInduced/metalpy/commit/0bfac3d03a836d64941428091ef0a094ecd4027e)]
- â™»ï¸ é‡æ„Shape3Dçš„é»˜è®¤å®ç°è®¾è®¡ [[4da63a3](https://github.com/MetallyInduced/metalpy/commit/4da63a338c303f86c1b85298eb02b5008cce00aa)]
- â™»ï¸ ä¼˜åŒ–ti_solversçš„ç©ºé—´åˆ†é…é€»è¾‘ï¼Œå°†xå’Œbçš„åˆ†é…ç»†èŠ‚ç§»è‡³æ±‚è§£å™¨å†… [[b36da60](https://github.com/MetallyInduced/metalpy/commit/b36da606415020eb0ff38f615b4d2638bc47de44)]
- â™»ï¸ Scene.create_meshæ”¹ä¸ºè¿”å›ModelledMeshå®ä¾‹ä»¥å®ç°æ›´çµæ´»åœ°ç½‘æ ¼ä¼˜åŒ–æ“ä½œ [[6898778](https://github.com/MetallyInduced/metalpy/commit/6898778a6c082f9630aac8bb4d5ac4d1de92efc9)]

### Breaking changes

- ğŸ’¥ ä¸ºå®ç°æ›´ä¸€è‡´çš„æ¥å£ï¼Œç»‡å…¥æ¨¡å¼ä¿®é¥°å™¨ç§»è‡³Mixinå†…ä½œä¸ºé™æ€å‡½æ•°å­˜åœ¨ï¼ˆmixin.xxx -&gt; Mixin.xxxï¼‰ï¼ˆæ¶‰åŠreplaces/before/after/ignoresï¼‰ [[bbb9108](https://github.com/MetallyInduced/metalpy/commit/bbb9108f6782064cd79abacc9008a49028340200)]
- ğŸ’¥ ç”±äºæ˜æ˜¾çš„ä½¿ç”¨å€¾å‘ï¼ŒShape3D.rotateç°åœ¨é»˜è®¤ä½¿ç”¨è§’åº¦åˆ¶ [[4da63a3](https://github.com/MetallyInduced/metalpy/commit/4da63a338c303f86c1b85298eb02b5008cce00aa)]

### Fixed

- ğŸ› ä¿®å¤AerialSurvey.to_polydataé”™è¯¯åˆ¤æ–­å‚æ•°zç±»å‹çš„é—®é¢˜ [[cb04f9f](https://github.com/MetallyInduced/metalpy/commit/cb04f9f9f3576184a58d90d31fac9e1164ecc9fc)]
- ğŸ› ä¿®å¤FixedShapeNDArrayä¸­__array_ufunc__æ¥æ”¶ä¸åŒç±»å‹çš„æ•°ç»„æ—¶æ„å¤–è¿”å›NotImplementedçš„é—®é¢˜ [[8935a7b](https://github.com/MetallyInduced/metalpy/commit/8935a7b86342148109f7b4e8eb9f40b6d1dfae93)]
- ğŸ› ä¿®å¤Obj2ä¸­split_models_in_memoryç¼“å­˜æ¨¡å‹é”™è¯¯çš„é—®é¢˜ [[08f8985](https://github.com/MetallyInduced/metalpy/commit/08f8985151bcf6f27859d96ae07aaa8d5f5b03f4)]
- ğŸ› ä¿®å¤è€³åˆ‡æ³•ä¸‰è§’åŒ–å¤šè¾¹å½¢æ—¶é”™è¯¯å¤„ç†å…±çº¿å¤–ç‚¹çš„é—®é¢˜ [[fe6577b](https://github.com/MetallyInduced/metalpy/commit/fe6577b7b0501751ab55855d573cd04d432cfa7c)]
- ğŸ› ä¿®å¤GPUç‰ˆIntegratedé€€ç£æ±‚è§£å™¨åˆ†é…æ˜¾å­˜å¤±è´¥çš„é—®é¢˜ [[ac3cb92](https://github.com/MetallyInduced/metalpy/commit/ac3cb92b0f0ca555161c1c7d6c8d58a5805b3632)]


